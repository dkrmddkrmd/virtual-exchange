<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>κ°€μƒ μ£Όμ‹ κ±°λμ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h1 class="mb-4">π“ μ‹¤μ‹κ°„ μ£Όμ‹ μ‹μ„Έ</h1>

<table class="table table-hover table-bordered align-middle">
    <thead class="table-dark">
    <tr>
        <th>μΆ…λ© μ½”λ“</th>
        <th>μΆ…λ©λ…</th>
        <th>ν„μ¬κ°€ (KRW)</th>
        <th>μ£Όλ¬Έ (λ§¤μ/λ§¤λ„)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="stock : ${stocks}">
        <td th:text="${stock.code}">KRW-BTC</td>
        <td th:text="${stock.name}">λΉ„νΈμ½”μΈ</td>
        <td th:text="${#numbers.formatInteger(stock.currentPrice, 0, 'COMMA')} + ' μ›'">100,000,000 μ›</td>

        <td>
            <div class="d-flex gap-2">
                <input type="number" class="form-control" style="width: 80px;"
                       th:id="|quantity_${stock.code}|" placeholder="μλ‰" value="1">

                <button class="btn btn-success btn-sm"
                        th:data-code="${stock.code}"
                        onclick="buyStock(this.getAttribute('data-code'))">λ§¤μ</button>

                <button class="btn btn-danger btn-sm"
                        th:data-code="${stock.code}"
                        onclick="sellStock(this.getAttribute('data-code'))">λ§¤λ„</button>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<script>
    function buyStock(code) {
        const quantityInput = document.getElementById('quantity_' + code);
        const quantity = quantityInput.value;

        const requestData = {
            userId: 29,
            code: code,
            quantity: Number(quantity)
        };

        fetch('/orders/buy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                if (response.ok) {
                    alert(code + " " + quantity + "κ° λ§¤μ μ„±κ³µ!");
                    window.location.reload();
                } else {
                    // μ—λ¬ λ©”μ‹μ§€λ¥Ό alertλ΅ λ„μ›μ£Όλ©΄ λ””λ²„κΉ…μ΄ νΈν•©λ‹λ‹¤.
                    response.text().then(msg => alert("λ§¤μ μ‹¤ν¨: " + msg));
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function sellStock(code) {
        const quantityInput = document.getElementById('quantity_' + code);
        const quantity = quantityInput.value;

        const requestData = {
            userId: 29,
            code: code,
            quantity: Number(quantity)
        };

        fetch('/orders/sell', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestData)
        })
            .then(response => {
                if (response.ok) {
                    alert(code + " " + quantity + "κ° λ§¤λ„ μ„±κ³µ!");
                    window.location.reload();
                } else {
                    response.text().then(msg => alert("λ§¤λ„ μ‹¤ν¨: " + msg));
                }
            });
    }
</script>

</body>
</html>